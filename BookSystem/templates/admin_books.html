{% extends "admin_layout.html" %}
{% block admin_content %}

<div class="card shadow-lg mb-4">

  <!-- 卡片头：标题 + 添加按钮 -->
  <div class="card-header bg-gradient-info text-white d-flex justify-content-between align-items-center">
    <h5 class="mb-0 text-white">图书管理</h5>

    <!-- 添加图书按钮（补回的功能入口） -->
    <a href="/admin/book/add"
       class="btn btn-light shadow-sm">
      ➕ 添加图书
    </a>
  </div>

  <!-- 卡片主体：所有功能仍然完整包裹 -->
  <div class="card-body">

    <!-- 提示信息 -->
    {% if not keyword %}
    <p class="text-center mb-3" style="color: #000000; font-size: 16px;">当前显示前100条记录，如需查找特定书籍，请使用搜索功能。</p>
    {% endif %}

    <!-- 搜索区域 -->
    <form method="get" class="row g-2 mb-3">
      <div class="col-auto">
      <select name="field" class="form-select form-select-lg" 
              style="border: 2px solid #000000; height: 48px; 
                    padding-left: 1rem; 
                    background-position: right 1rem center; 
                    padding-right: 2.5rem;">
          <option value="all" {% if field=='all' %}selected{% endif %}>全部</option>
          <option value="isbn" {% if field=='isbn' %}selected{% endif %}>ISBN</option>
          <option value="title" {% if field=='title' %}selected{% endif %}>书名</option>
          <option value="author" {% if field=='author' %}selected{% endif %}>作者</option>
      </select>
      </div>
      <div class="col-auto">
        <input name="keyword"
               value="{{ keyword }}"
               class="form-control form-control-lg"
               placeholder="搜索关键字"
               style="border: 2px solid #000000; width: 250px; height: 48px;">
      </div>
      <div class="col-auto">
        <button class="btn bg-gradient-info btn-lg" style="height: 48px;">
          搜索
        </button>
      </div>
    </form>

    <!-- 表格区域 -->
    <div class="table-responsive">
      <table class="table align-items-center mb-0">
        <thead>
          <tr>
            <th style="width: 80px;">封面</th>
            <th style="width: 150px;">ISBN</th>
            <th style="width: 300px;">书名</th>
            <th style="width: 180px;">作者</th>
            <th class="text-center" style="width: 160px;">操作</th>
          </tr>
        </thead>
        <tbody>
          {% for b in books %}
          <tr>
            <td>
              {% if b[7] %}
                <img src="{{ b[7] }}" width="42" class="rounded shadow-sm">
              {% else %}
                <span class="text-muted">无</span>
              {% endif %}
            </td>
            <td>{{ b[0] }}</td>
            <td style="max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="{{ b[1] }}">{{ b[1] }}</td>
            <td style="max-width: 180px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" title="{{ b[2] }}">{{ b[2] }}</td>
            <td class="text-center">
              <a href="/admin/book/edit/{{ b[0] }}"
                 class="btn btn-primary btn-sm me-1">
                编辑
              </a>

              <form method="post"
                    action="/admin/book/delete/{{ b[0] }}"
                    class="d-inline"
                    onsubmit="return confirm('确认删除该图书？')">
                <button class="btn btn-danger btn-sm">
                  删除
                </button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </div>
</div>

{% endblock %}
