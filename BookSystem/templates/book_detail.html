{% extends "layout.html" %}

{% block content %}
<div class="row">
    <div class="col-md-4">
        <img src="{{ book[7] }}" class="img-fluid rounded" alt="å°é¢"> </div>
    
    <div class="col-md-8">
        <h2>{{ book[1] }}</h2> <p class="text-muted">ä½œè€…: {{ book[2] }} | å¹´ä»½: {{ book[3] }}</p>
        <p>å‡ºç‰ˆç¤¾: {{ book[4] }}</p>
        
        <hr>
        
        <h4>â­ å¹³å‡è¯„åˆ†: {{ avg_rating }} / 10</h4>

        {% if session.get('user_id') %}
            <div class="card mt-3">
                <div class="card-body">
                    <form method="post" class="mb-3">
                        <input type="hidden" name="action" value="rate">
                        <label>æˆ‘çš„è¯„åˆ† (å½“å‰: {{ my_rating or 'æœªè¯„' }}):</label>
                        <div class="input-group">
                            <input type="number" name="rating" min="0" max="10" class="form-control" placeholder="0-10" required>
                            <button class="btn btn-primary" type="submit">æ‰“åˆ†</button>
                        </div>
                    </form>

                    <form method="post" class="d-inline">
                        <input type="hidden" name="action" value="wishlist">
                        <button class="btn btn-outline-danger" type="submit">â¤ï¸ åŠ å…¥æƒ³çœ‹</button>
                    </form>
                    
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#editForm">
                        ğŸ› ï¸ çº é”™åé¦ˆ
                    </button>
                    
                    <div class="collapse mt-2" id="editForm">
                        <form method="post">
                            <input type="hidden" name="action" value="request_edit">
                            <textarea name="content" class="form-control" placeholder="è¯·æè¿°é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚ï¼šä½œè€…åå­—å†™é”™...ï¼‰"></textarea>
                            <button class="btn btn-sm btn-warning mt-2" type="submit">æäº¤ç”³è¯·</button>
                        </form>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="alert alert-info">è¯· <a href="/login">ç™»å½•</a> åè¿›è¡Œè¯„åˆ†æˆ–æ”¶è—ã€‚</div>
        {% endif %}
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}